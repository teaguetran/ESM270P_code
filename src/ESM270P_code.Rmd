---
title: "ESM270P_coding"
author: "Teague Tran"
date: "11/30/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(sf)
library(here)
library(tidyverse)
library(janitor)
library(stars)
library(rgdal)
```
```{r}
# read in raster for 2020

scenario_raster_scenario1_2020 <-  read_stars(here("data", "cwhr_MIROC5_85_Scenario1_v3_20210824_1050_0.tif"))

#vectorize raster to be able to perform the habitat quality table fix
scenario_vector_scenario1_2020 <- st_as_sf(scenario_raster_scenario1_2020[1], merge = FALSE, as_points = F)
#set crs to NAD83 UTM zone 10
st_crs(scenario_vector_scenario1_2020) <- 3310
#set column names to grid code and geometry
colnames(scenario_vector_scenario1_2020) <- c("gridcode", "geometry")

#put scenario vector into lulc_select to be able to break apart lulc code 
lulc_select <- scenario_vector_scenario1_2020

#let's break apart landuse stuff 
lulc_sep_2020 <- lulc_select %>% 
  mutate(last_2 = lulc_select$gridcode %% 100) %>%
  mutate(first_two = substr(lulc_select$gridcode, 1, nchar(lulc_select$gridcode)-2 )) 

#separate the number in the gridcode to create new columns
lulc_sep_2020 <- lulc_sep_2020 %>% 
  mutate(second_last = substr(lulc_sep_2020$last_2, 1, 1) ) %>% 
  mutate(first_last = lulc_select$gridcode %% 10) %>% 
  mutate(forest_type = first_two) %>% 
  mutate(seral_stage = second_last) %>% 
  mutate(canopy_cover = first_last) %>% 
  mutate(ecoregion_type = as.numeric(forest_type)) 

#make no values into 0; will need to change for GP analysis
#create land use cover code based on 1 = nonforest, 2 = conifer, 3 = hardwood, 4 = mixed, 5 = shrub
lulc_sep_2020 <- lulc_sep_2020 %>% 
  mutate(landcover_code = ecoregion_type) 

lulc_sep_2020$landcover_code[lulc_sep_2020$landcover_code == "non-forest" ] <- 1

lulc_sep_2020$landcover_code[lulc_sep_2020$landcover_code == "conifer" ] <- 2

lulc_sep_2020$landcover_code[lulc_sep_2020$landcover_code == "hardwoods" ] <- 3

lulc_sep_2020$landcover_code[lulc_sep_2020$landcover_code == "mixed" ] <- 4

lulc_sep_2020$landcover_code[lulc_sep_2020$landcover_code == "shrub" ] <- 5

#change class to numeric to wrangle data
lulc_sep_2020$landcover_code <- as.numeric(lulc_sep_2020$landcover_code)

#change 0-10% canopy cover to non-forested ecoregion; used numbers cuz I changed it to numeric; 0-10% canopy cover does not count!

lulc_sep_2020$landcover_code <- with(lulc_sep_2020, ifelse(lulc_sep_2020$canopy_cover == "0-10", lulc_sep_2020$landcover_code/lulc_sep_2020$landcover_code, lulc_sep_2020$landcover_code*1))
  
#write it out into shape file!
st_write(lulc_sep_2020, "tcsi_landcover_2020.shp")
```